# コード変更ワークフローガイドライン

## 概要

このプロジェクトにおけるコード変更のワークフローを定義します。安全で効率的な開発を確保するためのガイドラインです。

## 基本原則

### 🔴 禁止事項
- **即時コード編集の禁止**: 修正内容を提案してから、ユーザーの承認を得てからコードに反映すること
- **リスクの高い変更の即時実行禁止**: RLSポリシー、データベーススキーマ、セキュリティ関連の変更は必ず提案・承認を経ること

### ✅ 必須事項
- **提案→承認→実行の順守**: 全てのコード変更でこの順序を守ること
- **影響範囲の明確化**: 変更が及ぼす影響を事前に説明すること
- **ロールバック計画**: 問題発生時の対応策を提示すること

## ワークフロー

### フェーズ1: 問題分析
1. エラーメッセージ、ログ、動作の確認
2. 根本原因の特定
3. 影響範囲の調査

### フェーズ2: 修正提案
1. **具体的な修正内容を記述**
   - 変更するファイル
   - 変更内容の詳細
   - 期待される結果

2. **リスク評価**
   - 影響を受ける機能
   - ロールバック方法
   - テスト方法

3. **代替案の提示**（可能な場合）
   - より安全な方法
   - 段階的なアプローチ

### フェーズ3: 承認待ち
- ユーザーの承認を待つ
- 質問への回答
- 必要に応じて提案の修正

### フェーズ4: 実行
1. 承認後、コード変更を実行
2. テスト実施
3. コミット・デプロイ

## 変更タイプ別のガイドライン

### 🟢 低リスク変更
**即時実行可能:**
- UIテキストの修正
- コメント追加
- ログ出力の追加
- タイポ修正

**承認不要だが報告必須:**
- 変更内容を簡潔に報告

### 🟡 中リスク変更
**提案・承認必須:**
- 新機能追加
- 既存機能の拡張
- 設定変更
- APIエンドポイント追加

### 🔴 高リスク変更
**提案・承認必須 + 詳細レビュー:**
- データベーススキーマ変更
- RLSポリシー変更
- セキュリティ関連変更
- 認証・認可ロジック変更
- Migrationファイル作成

## エスカレーション基準

### 🚨 即時エスカレーション
- データベースの破損リスク
- セキュリティホールの可能性
- 既存機能の完全停止リスク
- 複数チームメンバーに影響

### ⚠️ 要相談
- ユーザー体験の大幅変更
- パフォーマンスに影響する変更
- サードパーティAPIの変更

## ロールバック計画

### 必須項目
- **変更前の状態保存**: git stash または 別ブランチ
- **即時ロールバック方法**: 変更を戻す具体的手順
- **検証方法**: ロールバック後の動作確認

### 緊急ロールバック手順
```bash
# コード変更の即時ロールバック
git checkout HEAD -- [変更ファイル]

# データベース変更のロールバック
# (migrationファイルがある場合はDROP文を実行)
```

## コミュニケーション

### 提案時の必須情報
```
## 修正提案: [問題の簡潔な説明]

### 問題分析
[根本原因と影響範囲]

### 修正内容
[具体的な変更内容]

### リスク評価
[影響とロールバック計画]

### テスト方法
[動作確認手順]

### 承認をお願いします
```

### 承認後の実行報告
```
## ✅ 修正完了: [問題の説明]

### 実行内容
[実際に変更した内容]

### テスト結果
[動作確認結果]

### コミット情報
[コミットハッシュなど]
```

## 例外ケース

### 緊急修正
- **条件**: サービス停止、セキュリティ侵害、データ損失のリスク
- **手順**: 問題の概要を報告後、即時実行
- **後処理**: 実行後に詳細を報告し、承認を得る

### 細かい調整
- **条件**: 同じ問題の繰り返しの小さな修正
- **手順**: 初回のみ提案・承認、以後は簡易報告

## 定期レビュー

- **毎月**: このガイドラインの有効性をレビュー
- **変更時**: プロジェクトメンバーに通知
- **改善**: フィードバックを基に更新

---

**最終更新**: 2025-11-27
**作成者**: AI Assistant
**承認者**: プロジェクトオーナー
