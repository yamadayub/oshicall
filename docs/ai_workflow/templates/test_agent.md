# テストエキスパート用プロンプトテンプレート

## 使用目的

Sub Agent 1（テストエキスパート）が業務仕様からテストケースを設計し、テストコードを生成する際に使用するプロンプトテンプレートです。

---

## 📋 基本テンプレート

```markdown
# Sub Agent 1: テスト設計タスク

## 対象業務仕様
/docs/business/{{業務名}}.md の {{BR-xxx}}

## 依頼内容
{{機能名}}のテストを設計してください。

### Step 1: 業務仕様の確認（まず報告）
以下の業務仕様を確認し、テストケースを設計してください：

1. **業務仕様の読み込み**
   - ファイル: `/docs/business/{{業務名}}.md`
   - ビジネスルール: {{BR-xxx}}

2. **テストケース設計**
   各ビジネスルール（BR-xxx）に対応するテストケースを設計してください：

   ```
   BR-xxx: {{ルール名}}
     ✓ 正常系: {{正常系のケース説明}}
     ✓ 正常系: {{別の正常系ケース}}
     ✗ 異常系: {{異常系のケース説明}}
     ⚠ エッジケース: {{境界値やエッジケース}}
   ```

3. **テスト計画書の概要**
   テスト計画書に含めるべき内容を報告してください。

### Step 2: テスト計画書作成（承認後）
以下の形式でテスト計画書を作成してください：

**ファイル**: `/docs/test/plans/{{機能名}}_TEST_PLAN.md`

**フォーマット**:
```markdown
# {{機能名}} テスト計画書

## 対応する業務仕様
/docs/business/{{業務名}}.md の {{BR-xxx}}

## テストケース一覧

### BR-xxx: {{ルール名}}

#### TC-xxx-001: {{テストケース名}}
- **種別**: 正常系
- **前提条件**: {{前提条件}}
- **実行手順**: {{実行手順}}
- **期待結果**: {{期待結果}}

#### TC-xxx-002: {{テストケース名}}
- **種別**: 異常系
- **前提条件**: {{前提条件}}
- **実行手順**: {{実行手順}}
- **期待結果**: {{期待結果}}
```

### Step 3: E2Eテスト生成（承認後）
以下の形式でE2Eテストコードを生成してください：

**ファイル**: `e2e/{{機能名}}.spec.ts`

**フォーマット**:
```typescript
import { test, expect } from '@playwright/test';

test.describe('{{機能名}}', () => {
  test.describe('{{BR-xxx}}: {{ルール名}}', () => {
    test('TC-xxx-001: {{テストケース名}}', async ({ page }) => {
      // 1. セットアップ（ログインなど）
      // 2. アクション実行
      // 3. アサーション
      await expect(page.locator('{{セレクタ}}')).toHaveText('{{期待値}}');
    });

    test('TC-xxx-002: {{テストケース名}}', async ({ page }) => {
      // テスト実装
    });
  });
});
```

**要件**:
- Playwrightを使用すること
- テストケースIDは `TC-xxx-xxx` 形式
- `test.skip()` は使わず、実装可能な状態で生成すること
- テストは失敗する状態でOK（実装がないため）

### Step 4: Unitテスト生成（承認後）
以下の形式でUnitテストコードを生成してください：

**ファイル**: `src/{{コンポーネント/ユーティリティ}}.test.ts`

**フォーマット**:
```typescript
import { describe, it, expect } from 'vitest';
import { render, screen } from '@testing-library/react';

describe('{{コンポーネント名}}', () => {
  describe('{{BR-xxx}}: {{ルール名}}', () => {
    it('TC-xxx-001: {{テストケース名}}', () => {
      // テスト実装
      expect(actual).toBe(expected);
    });
  });
});
```

**要件**:
- Vitest + @testing-library/react を使用すること
- テストケースIDは `TC-xxx-xxx` 形式
- コンポーネントのロジックをテストすること

### Step 5: 完了報告
以下の形式で完了報告をしてください：

```
✅ テスト設計完了

【成果物】
- テスト計画書: /docs/test/plans/{{機能名}}_TEST_PLAN.md
- E2Eテスト: e2e/{{機能名}}.spec.ts
- Unitテスト: src/{{コンポーネント}}.test.ts

【テストケース数】
- E2Eテスト: {{数}}個
- Unitテスト: {{数}}個

【備考】
{{補足情報}}
```

## 重要ルール
- テストコードは業務仕様の BR-xxx と対応させること
- 実装コードは書かない（テストのみ）
- テストは失敗する状態でOK（実装がないため）
- test.skip() は使わない
- テストケースIDは TC-xxx-xxx 形式で統一すること
```

---

## 📝 具体例

### 例1: ビデオ通話入室機能のテスト設計

```markdown
# Sub Agent 1: テスト設計タスク

## 対象業務仕様
/docs/business/video-call.md の BR-008, BR-009, BR-010

## 依頼内容
ビデオ通話入室機能のテストを設計してください。

### Step 1: 業務仕様の確認（まず報告）
以下の業務仕様を確認し、テストケースを設計してください：

1. **業務仕様の読み込み**
   - ファイル: `/docs/business/video-call.md`
   - ビジネスルール: BR-008「入室状態表示」, BR-009「インフルエンサーの入室タイミング」, BR-010「ファンの入室タイミング」

2. **テストケース設計**
   各ビジネスルールに対応するテストケースを設計してください：

   ```
   BR-008: 入室状態表示
     ✓ 正常系: インフルエンサーが先に入室（ファン未入室表示）
     ✓ 正常系: ファンが先に入室（インフルエンサー未入室表示）
     ✓ 正常系: 両者が入室（両者待機中表示）
     ✓ 正常系: 両者がDaily.co接続（両者通話中表示）
     ✗ 異常系: 片方のみ接続（状態の非対称表示）

   BR-009: インフルエンサーの入室タイミング
     ✓ 正常系: 15分前から入室可能
     ✓ 正常系: 15分前からDaily.co接続可能
     ✗ 異常系: 16分前は接続不可
     ⚠ エッジケース: ちょうど15分前
     ✓ 正常系: 開始時刻の30分後まで入室可能

   BR-010: ファンの入室タイミング
     ✓ 正常系: 開始前に入室可能（待機画面表示）
     ✓ 正常系: 開始時刻に自動接続
     ✓ 正常系: 開始後は接続済み状態
     ⚠ エッジケース: ちょうど開始時刻
     ✓ 正常系: 開始時刻の30分後まで入室可能
   ```

3. **テスト計画書の概要**
   テスト計画書には以下の内容を含める：
   - 各テストケースの詳細（前提条件、実行手順、期待結果）
   - テストデータ
   - テスト環境

### Step 2-5: [テスト計画書・テストコード生成]
[上記テンプレートに従って生成]
```

---

## 🎯 使い方

### 1. プロンプトの準備

1. 上記のテンプレートをコピー
2. `{{変数}}` 部分を実際の値に置き換え
3. Cursorに貼り付け

### 2. 実行

1. Cursorでプロンプトを実行
2. Step 1の結果を確認・承認
3. Step 2-5を順次実行

### 3. 確認と調整

1. 生成されたテストコードを確認
2. 業務仕様との対応を確認
3. テストケースIDの形式を確認

---

## ⚠️ 注意事項

### テストケースIDの命名規則

- **形式**: `TC-{{BR番号}}-{{連番}}`
- **例**: `TC-008-001`, `TC-008-002`, `TC-009-001`

### テストコードの品質

- **可読性**: テストコードは明確で理解しやすいこと
- **独立性**: 各テストケースは独立して実行可能であること
- **再現性**: 同じ条件で実行すれば同じ結果になること

### test.skip() の使用禁止

- 実装がない場合でも `test.skip()` は使わない
- テストコードは実装可能な状態で生成する
- テストは失敗する状態でOK（実装後に通過する）

---

## 📚 関連ドキュメント

- [複数Agent開発ガイド](../MULTI_AGENT_DEVELOPMENT_GUIDE.md) - 複数Agentを使った開発方法
- [AI-TDD開発ガイド（シングルAgent開発）](../AI_TDD_DEVELOPMENT_GUIDE.md) - 1つのAI Agentで全てのタスクを処理する方法
- [E2Eテストガイド](../../test/E2E_TEST_GUIDE.md) - E2Eテストの手順
- [Main Agent用プロンプト](./main_agent_orchestration.md) - Main Agentからの指示

---

**最終更新**: 2026-01-02  
**作成者**: AI Assistant  
**承認者**: プロジェクトオーナー